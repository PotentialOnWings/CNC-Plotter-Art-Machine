#include <Stepper.h>
#include <Servo.h>
#include <stdbool.h>
#include <stdio.h>

const int stepsPerRevolution = 20; 
Servo penServo;//initiates servo
int servoPin = 6;//pin servo is connected to

Stepper xAxis(stepsPerRevolution, 2,3,10,11); //pins x axis motor are connected to
Stepper yAxis(stepsPerRevolution, 4,5,8,9); //pins y axis motor are connected to

bool draw = true;

int numLines = 0;
int xstep;
int ystep;
int xold;
int yold;
//how often it alternates between x and y
int altYRatio;

void penUp();
void penDown();
void makeLoop(int n, int altYStep);


void setup(){
  penServo.attach(servoPin);//attach servo to arduino
  Serial.begin(9600);
  
}
 
void loop() {
  short coords[418][2] = {{22,90},
{23,96},
{24,86},
{24,96},
{25,86},
{25,92},
{25,98},
{26,86},
{26,92},
{26,99},
{27,87},
{27,93},
{27,99},
{28,43},
{28,82},
{28,89},
{28,100},
{29,34},
{29,43},
{29,49},
{29,81},
{29,88},
{29,101},
{30,28},
{30,34},
{30,40},
{30,51},
{30,80},
{30,101},
{31,24},
{31,38},
{31,45},
{31,54},
{31,79},
{31,85},
{31,102},
{31,195},
{32,21},
{32,38},
{32,47},
{32,54},
{32,78},
{32,85},
{32,102},
{32,180},
{32,186},
{32,192},
{33,18},
{33,39},
{33,49},
{33,55},
{33,76},
{33,82},
{33,103},
{33,158},
{33,164},
{33,170},
{33,176},
{34,15},
{34,40},
{34,51},
{34,57},
{34,65},
{34,73},
{34,79},
{34,85},
{34,103},
{34,119},
{34,125},
{34,131},
{34,137},
{34,143},
{34,149},
{34,155},
{35,12},
{35,40},
{35,55},
{35,69},
{35,75},
{35,86},
{35,103},
{35,109},
{35,115},
{36,9},
{36,40},
{36,53},
{36,59},
{36,65},
{36,71},
{36,85},
{36,103},
{37,0},
{37,6},
{37,41},
{37,54},
{37,60},
{37,66},
{37,72},
{37,78},
{37,85},
{37,91},
{37,103},
{38,6},
{38,42},
{38,59},
{38,66},
{38,72},
{38,84},
{38,93},
{38,103},
{39,8},
{39,15},
{39,45},
{39,60},
{39,73},
{39,86},
{39,98},
{40,8},
{40,14},
{40,47},
{40,61},
{40,73},
{40,89},
{40,98},
{41,11},
{41,19},
{41,49},
{41,55},
{41,62},
{41,74},
{41,91},
{41,97},
{41,104},
{42,19},
{42,50},
{42,58},
{42,64},
{42,75},
{42,92},
{42,98},
{42,104},
{42,138},
{43,19},
{43,51},
{43,59},
{43,65},
{43,75},
{43,93},
{43,101},
{43,137},
{43,143},
{44,19},
{44,52},
{44,58},
{44,65},
{44,76},
{44,92},
{44,101},
{44,137},
{44,143},
{45,20},
{45,53},
{45,66},
{45,77},
{45,92},
{45,98},
{45,136},
{45,142},
{46,22},
{46,54},
{46,60},
{46,67},
{46,77},
{46,91},
{46,100},
{46,135},
{46,146},
{47,24},
{47,55},
{47,62},
{47,68},
{47,77},
{47,90},
{47,100},
{47,131},
{47,137},
{47,148},
{48,27},
{48,56},
{48,63},
{48,69},
{48,78},
{48,89},
{48,95},
{48,102},
{48,130},
{48,136},
{48,142},
{48,152},
{49,30},
{49,55},
{49,64},
{49,79},
{49,89},
{49,95},
{49,129},
{49,138},
{49,144},
{49,150},
{50,31},
{50,55},
{50,63},
{50,69},
{50,79},
{50,88},
{50,96},
{50,102},
{50,128},
{50,137},
{50,149},
{50,156},
{51,33},
{51,55},
{51,61},
{51,69},
{51,80},
{51,87},
{51,96},
{51,128},
{51,137},
{51,149},
{51,155},
{52,35},
{52,56},
{52,62},
{52,70},
{52,81},
{52,87},
{52,97},
{52,127},
{52,137},
{52,149},
{52,155},
{52,161},
{53,38},
{53,63},
{53,71},
{53,82},
{53,97},
{53,127},
{53,137},
{53,143},
{53,149},
{53,156},
{53,162},
{54,40},
{54,64},
{54,71},
{54,83},
{54,97},
{54,126},
{54,136},
{54,143},
{54,152},
{54,158},
{54,164},
{55,41},
{55,65},
{55,72},
{55,83},
{55,98},
{55,126},
{55,135},
{55,143},
{55,153},
{55,159},
{55,198},
{56,43},
{56,65},
{56,72},
{56,83},
{56,98},
{56,119},
{56,125},
{56,135},
{56,143},
{56,153},
{56,160},
{56,197},
{57,44},
{57,66},
{57,72},
{57,82},
{57,98},
{57,118},
{57,125},
{57,135},
{57,153},
{57,161},
{57,197},
{58,46},
{58,67},
{58,73},
{58,81},
{58,98},
{58,118},
{58,124},
{58,132},
{58,138},
{58,163},
{58,197},
{59,47},
{59,73},
{59,80},
{59,97},
{59,118},
{59,124},
{59,132},
{59,141},
{59,165},
{59,196},
{60,49},
{60,70},
{60,80},
{60,97},
{60,118},
{60,131},
{60,139},
{60,166},
{60,196},
{61,50},
{61,70},
{61,76},
{61,97},
{61,118},
{61,131},
{61,139},
{61,167},
{61,196},
{62,52},
{62,70},
{62,77},
{62,97},
{62,118},
{62,130},
{62,138},
{62,168},
{62,196},
{63,54},
{63,70},
{63,76},
{63,98},
{63,117},
{63,129},
{63,137},
{63,170},
{63,196},
{64,55},
{64,71},
{64,77},
{64,98},
{64,116},
{64,129},
{64,137},
{64,171},
{64,196},
{65,58},
{65,71},
{65,98},
{65,113},
{65,129},
{65,172},
{65,196},
{66,59},
{66,71},
{66,98},
{66,112},
{66,128},
{66,173},
{66,196},
{67,62},
{67,72},
{67,99},
{67,110},
{67,118},
{67,128},
{67,173},
{67,196},
{68,64},
{68,72},
{68,98},
{68,106},
{68,113},
{68,119},
{68,127},
{68,174},
{68,197},
{69,65},
{69,72},
{69,102},
{69,108},
{69,117},
{69,126},
{69,132},
{69,175},
{70,67},
{70,101},
{70,116},
{70,126},
{70,175},
{70,182},
{71,68},
{71,107},
{71,116},
{71,125},
{71,131},
{71,176},
{71,182}};

  delay (200);
  char coord;
  int line = 0;
  Serial.print("hi is this working??????");
  xAxis.setSpeed(100);
  yAxis.setSpeed(100);

  while (draw == true){  
    delay(5000); //pause for 5 seconds
    xold = coords[0][0]/2;
    yold = coords[0][1]/2;
    singleLoop(xold);
    singleLoop(yold);
    penDown();
    
    for (int i = 1; i < 418; i++){
      xstep = coords[i][0] - xold;
      ystep = coords[i][1] - yold;
      if (xstep > 0){
        Serial.print(xstep); Serial.print(ystep);
        singleLoop(xstep);
        singleLoop(ystep);
      }
      xold = coords[i][0];
      yold = coords[i][1];
    }
    penUp();
    draw = false;
  }
}

void singleLoop(int n){
  Serial.print("Drawing!!");
  Serial.print(n);
  for (int i = 0; i < n; i++){
    xAxis.step(1);
    delay(1);
  }
}

void penUp(){
  penServo.write(70);//pulls pen up 
  delay(3000); //pause for 3 seconds
}

void penDown(){
  penServo.write(0);//pulls pen up
  delay(3000); //pause for 3 seconds 
}
